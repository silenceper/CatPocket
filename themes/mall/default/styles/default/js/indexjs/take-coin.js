KISSY.add("TakeCoin",function(d,c){var a=d.DOM,m=d.Event,i=window.document,h;var g,e=0;var b=[];var f=location.host.indexOf(".taobao.net")===-1,l=f?"http://taojinbi.taobao.com":"http://taojinbi.daily.taobao.net";var k='<div class="lqcg_title">   <h3>\u6bcf\u5e2e\u9886\u4e00\u4e2a\u597d\u53cb\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230<em>5\u4e2a\u6dd8\u91d1\u5e01</em>\u7684\u5956\u52b1\uff01\uff0815\u4e2a\u6dd8\u91d1\u5e01\u5c01\u9876\uff09</h3>	<p>	\u4f60\u53ef\u4ee5\u5e2e\u672a\u9886\u53d6\u6dd8\u91d1\u5e01\u7684\u597d\u53cb\uff08\u6700\u591a10\u4e2a\uff09\u4ee3\u53d610%\u7684\u91d1\u5e01.<br />	\u8fd9\u4e9b\u6dd8\u91d1\u5e01\u4f1a\u6253\u5165\u597d\u53cb\u8d26\u6237\uff0c\u597d\u53cb\u5f53\u65e5\u4e0a\u7ebf\u540e\uff0c\u53ef\u4ee5\u9886\u53d6\u5269\u4f59\u768490%.<br />   <a href="http://blog.jianghu.taobao.com/u/MzUyNzY2NDc0/blog/blog_detail.htm?aid=48546121" target="_blank">\u67e5\u770b\u5e2e\u9886\u91d1\u5e01\u89c4\u5219\u8be6\u60c5 <strong>&gt;</strong></a>	</p>   <a style="float:right" href="http://jianghu.taobao.com/admin/invite/invite_friend.htm?tracelog=bljb04" target="_blank">\u597d\u53cb\u4e0d\u5728\uff1f\u9080\u8bf7\u4ed6\u6765\uff5e</a></div><div class="jinbi-friends-c"><div class="jinbi-friends-t"><strong>\u9009\u62e9\u597d\u53cb</strong>\uff08\u6bcf\u5929\u6700\u591a\u53ea\u80fd\u5e2e<em>10\u4e2a\u597d\u53cb</em>\u9886\u53d6\uff09</div><div class="jinbi-friends-bd clearfix"><div class="jinbi-friends-tree" id="tree"><img class="loading" style="margin:0 0 100px 100px;" alt="loading ..." src="http://img06.taobaocdn.com/tps/i6/T13l0vXhRrXXXXXXXX-24-24.gif"></div><div class="jinbi-friends-select"><h4>\u5df2\u9009\u62e9</h4><div id="J_SelectedUsers" class="jinbi-friends-select-bd clearfix"></div><div id="J_ErrorMsg" class="jinbi-friends-error"></div></div></div></div>';function j(n,p){var o=this;if(!(o instanceof j)){return new j(n,p)}p=p||{};p=d.merge(j.Config,p);o.container=d.get(n);o.config=p;o._init()}j.Config={coinHost:l};d.augment(j,d.EventTarget,{_init:function(){var o=this,n=o.config;a.create('<img src="http://www.atpanel.com/jsclick?cache='+Math.ceil(Math.random()*Math.pow(10,7))+'&tracelog=bljb01" alt=" " />');o._check()},_check:function(){var p=this,o=p.config;var n=o.coinHost+"/ajax/take/check_take.htm";d.IO.get(n,{method:"checkTakeUser",takenNum:1,t:new Date().getTime(),tracelog:"bljb01"},function(r){var q=r.result;if("true"==q.status){p._showTakePannel()}else{new SNS.sys.Popup({title:"\u5e2e\u9886\u5931\u8d25",width:400,content:'<div class="popup-message  icon-cry" style="margin-top:10px;">'+q.msg+"</div>",buttons:[{text:"\u786e\u5b9a",func:function(){this.hide()}}]});return false}return true},"json")},_showTakePannel:function(){var o=this,n=o.config;h=new SNS.sys.Popup({type:"sns-popup-bl",width:580,title:"\u5e2e\u597d\u53cb\u9886\u6dd8\u91d1\u5e01",hideMask:false,extraWrapperClass:"jinbi-friends",content:k,autoShow:false,focus:1,buttons:[{text:"\u786e\u5b9a",func:function(){o._confirmTakeCoin()}},{text:"\u53d6\u6d88",func:function(){this.hide()}}]});h.show();var p=setInterval(function(){if(a.get("#tree")){o._renderFriendTree();clearInterval(p)}},10)},_renderFriendTree:function(){var o=this,n=o.config;SNS.use(["SNS.widget.FriendTree"],function(){g=new SNS.widget.FriendTree({wapper:"#tree",twoway:true,placer:"#J_SelectedUsers",isShowGroup:false,isShowPeople:true,isShowSearch:true,isFilter:true,max:10,defaultGroupOpen:[1],onFlow:function(){o._showError("\u6bcf\u5929\u6700\u591a\u53ea\u80fd\u5e2e"+this.max+"\u4e2a\u597d\u53cb\u9886\u53d6\u54e6\uff01");o._getSelectedUsers()},onFilter:function(r,q,s,p){o._checkTakenUser(r,q,s,p)}},function(){})})},_checkTakenUser:function(s,p,q,t){var w=this,r=w.config,u=r.coinHost+"/ajax/take/check_take.htm";var v=a.get("#J_SelectedUsers"),o=a.query(".J_UserItem",v),n=o.length+1;d.IO.get(u,{method:"checkTakenUser",takenUserId:q,takenNum:n,t:new Date().getTime()},function(z){var y=z.result;if(y.status=="true"){g.methods.onCheckboxOperate(s,p,"select")}else{w._showError(y.msg);g.methods.onCheckboxOperate(s,p,"cannel")}var x=t.length;if(t&&x>1&&n<10&&x>e){e++;w._checkTakenUser(t[e],p,a.attr(t[e],"data-id"),t)}else{e=0}},"json")},_getSelectedUsers:function(){b=[];var p=a.get("#J_SelectedUsers"),q=a.query(".J_UserItem",p);var o=0,n=q.length;for(;o<n;o++){b.push(String(a.attr(q[o],"data-id")))}},_confirmTakeCoin:function(){var q=this,p=q.config,o=document.getElementsByName("_tb_token_")[0].value,n=p.coinHost+"/ajax/take/coin_take.htm";q._getSelectedUsers();if(b==null||b.length==0){q._showError("\u8bf7\u9009\u62e9\u597d\u53cb");return false}d.IO.post(n,{takeIds:b.join(","),_tb_token_:o,t:new Date().getTime()},function(s){var r=s.result;if("true"==r.status){q._takeSuccessPannel(r.successNames,r.failNames,r.takeCoin);return true}else{if("false"==r.status){q._takeFailPannel(r.msg);return false}}},"json")},_takeSuccessPannel:function(r,n,u){var q=this,p=q.config,t=u!="0"?("<p>\u7cfb\u7edf\u5956\u52b1\u4e86\u4f60<strong><em>"+u+"</em></strong>\u4e2a\u6dd8\u91d1\u5e01\uff0815\u4e2a\u6dd8\u91d1\u5e01\u5c01\u9876\uff09</p>"):"";var s='<div class="lqcg_popup"><div class="lqcg_content" style="margin-left:15px;"><p><strong>\u5e2e\u9886\u6210\u529f!</strong></p><p>\u606d\u559c\u4f60\u6210\u529f\u4e3a'+r+"\u5e2e\u9886\u4e86\u6dd8\u91d1\u5e01\uff01<br />\u6dd8\u91d1\u5e01\u5df2\u7ecf\u6253\u5165\u4ed6\u4eec\u7684\u8d26\u53f7\uff01</p>"+t+'<p class="lqcg_content_btn">	<span class="act skin-gray coin-act"><span class="btn coin-btn"><a href="javascript:;" class="J_CloseSuccess">\u786e\u5b9a</a></span></span></p></div></div>';h.hide();var o=new SNS.sys.Popup({title:"\u5e2e\u597d\u53cb\u9886\u6dd8\u91d1\u5e01",width:450,content:s,buttons:[]});m.on(".J_CloseSuccess","click",function(){o.hide()})},_takeFailPannel:function(n){h.hide();new SNS.sys.Popup({title:"\u5e2e\u9886\u5931\u8d25",width:400,content:'<div class="popup-message  icon-cry">'+n+"</div>",buttons:[{text:"\u786e\u5b9a",func:function(){this.hide()}}]})},_showError:function(o){var n=a.get("#J_ErrorMsg");a.html(n,"<span>"+o+"</span>");setTimeout(function(){a.html(n,"")},2000)}});d.TakeCoin=j},{requires:["core"]});