/*pub-2|2011-12-02 13:27:58*/KISSY.add("cookie",function(a){function e(a){return typeof a=="string"&&a!==""}var b=document,c=encodeURIComponent,d=decodeURIComponent;a.Cookie={get:function(a){var c,f;return e(a)&&(f=b.cookie.match("(?:^| )"+a+"(?:(?:=([^;]*))|;|$)"))&&(c=f[1]?d(f[1]):""),c},set:function(a,d,f,g,h,i){var j=c(d),k=f;typeof k=="number"&&(k=new Date,k.setTime(k.getTime()+f*864e5)),k instanceof Date&&(j+="; expires="+k.toUTCString()),e(g)&&(j+="; domain="+g),e(h)&&(j+="; path="+h),i&&(j+="; secure"),b.cookie=a+"="+j},remove:function(a){this.set(a,"",0)}}}),KISSY.add("ajax",function(a){var b=document,c=a.UA;a.Ajax={request:function(){a.error("not implemented")},getScript:function(d,e,f){var g=b.getElementsByTagName("head")[0]||b.documentElement,h=b.createElement("script");h.src=d,f&&(h.charset=f),h.async=!0,a.isFunction(e)&&(c.ie?h.onreadystatechange=function(){var a=h.readyState;if(a==="loaded"||a==="complete")h.onreadystatechange=null,e()}:h.onload=e),g.appendChild(h)}}}),function(){function K(a){try{(new Image).src=a}catch(b){}}var a=KISSY,b=a.DOM,c=a.Event,d=a.Cookie,e=a.UA,f=a.Ajax,g=window,h=document,j=encodeURIComponent,k=decodeURIComponent,l=a.now(),m=unescape((d.get("_nk_")||"").replace(/\\u/g,"%u")),n="x",o,p=g.g_config||{},q="J_WangWang",r=1,s=0,t=function(){var a=location.hostname,b;return a.indexOf("tmall.com")>-1?(b="tmall.com",n="otherx"):a.indexOf("daily.tmall.net")>0?(b="daily.tmall.net",n="otherx"):a.indexOf("taobao.net")>0?b="taobao.net":b="taobao.com",b}(),u=/daily/i,v=!u.test(location.host),w=function(){return v?"taobao.com":"daily.taobao.net"}(),x=function(){return d.get("_l_g_")?!0:!1},y=6,z=(g.g_config||0).appId===6,A="http://www.taobao.com/webww/?ver=1&",B="http://amos.alicdn.com/getcid.aw",C="http://amos.alicdn.com/muliuserstatus.aw?beginnum=0&site=cntaobao&charset=utf-8&uids=",D="http://amos.alicdn.com/getRealCid.aw?fromId=cntaobao"+j(m)+"&toId=",E="http://www.atpanel.com/ww?cache="+l,F={SNS:"\u6211\u5728\u7ebf\uff0c\u548c\u6211\u804a\u804a\u5427~",DEFAULT:"\u70b9\u6b64\u53ef\u4ee5\u76f4\u63a5\u548c\u5356\u5bb6\u4ea4\u6d41\u9009\u597d\u7684\u5b9d\u8d1d\uff0c\u6216\u76f8\u4e92\u4ea4\u6d41\u7f51\u8d2d\u4f53\u9a8c\uff0c\u8fd8\u652f\u6301\u8bed\u97f3\u89c6\u9891\u5662\u3002"},G=["ie","firefox","chrome","safari","opera"],H=location.hostname.indexOf("tmall"),I=[1,2,10,8,12,12,12],J={addonIsOK:function(){return a.isBoolean(o)||(o=this._checkWangWangInstalled()),location.href.indexOf("topen")>-1?!1:o},data:{},lightedUsers:[],init:function(){var c=this;b.addStyleSheet(".ww-light{overflow:hidden;}.ww-block{display:block;margin-top:3px;}.ww-inline{display:inline-block;vertical-align:text-bottom;}.ww-light a{background:url(http://img04.taobaocdn.com/tps/i4/T1UPFAXnNfXXXXXXXX-130-60.gif) no-repeat 0 0;text-decoration:none!important;width:20px;height:20px;zoom:1;}.ww-large a{width:67px;}a.ww-offline{background-position:0 -20px;}a.ww-mobile{background-position:0 -40px;}.ww-small .ww-online{background-position:-80px 0;}.ww-small .ww-offline{background-position:-80px -20px;}.ww-small .ww-mobile{background-position:-80px -40px;}.ww-static .ww-online{background-position:-110px 0;}.ww-static .ww-offline{background-position:-110px -20px;}.ww-static .ww-mobile{background-position:-110px -40px;}.ww-light a span{display:none;}"),c.light();for(var d=0,e=G.length;d<e;++d)if(a.UA[G[d]]){s=G[d]+a.UA[G[d]];break}},initStart:function(){if(z)return;var b=a.unparam(location.search.substring(1));("g_config"in g&&"appId"in g.g_config&&g.g_config["appId"]!=-1||"tstart"in b||"tdog"in b)&&a.ready(function(){var a=function(a,b){b=b||location.hostname;var c=".",d=b.split(c),e=d.length;return e<=2?b:(a=a||1,a>e-2&&(a=e-2),d.slice(a).join(c))},b=h.getElementsByTagName("head")[0]||h.documentElement,c=h.createElement("link"),d=h.createElement("script"),e=a(2),f=/daily/i,g=!f.test(location.host),i=g?"a.tbcdn.cn":"assets.daily.taobao.net",j="http://"+i+"/p/header/adapter-min.js?t="+(new Date).getHours();if(e=="etao.com")return;d.src=j,b.insertBefore(d,b.firstChild)})},light:function(b){function A(a){D(s[a],r[a],t[a],function(){z++,z<x&&A(++a)})}function B(a){return e.ie&&a.length>p}function D(b,d,e,f){g.online=[],a.Ajax.getScript(C+b.join(";"),function(){a.each(d,function(b,d){a.query("a",b).length==0&&c._lightToken(b,e[d],g.online[d])}),f&&f()},"utf-8")}b=a.get(b)||h.body;var c=this,d=a.query("."+q,b),f=d.length;if(f===0)return;var i=[],k=[],l,m,n;for(n=0;n<f;++n)m=c._getParamsFromData(d[n]),i.push(m),l=m.nick,k.push(j(l));var o=100,p=1800,r=[],s=[],t=[],u="",v,w=0,x=0,y;for(v=0;v<f;++v){if(B(u+k[v])||v>=o||v===f-1)y=v===f-1?f:v,s[x]=k.slice(w,y),r[x]=d.slice(w,y),t[x]=i.slice(w,y),u="",w=v,x++;u+=k[v]+";"}A(0);var z=0},_lightToken:function(e,h,i){var l=this,m=b.create('<a href="javascript: void(0);" target="_blank"></a>'),o=h.encode?k(h.nick):h.nick,q=h.from+o,r=h.item,s=h.items,u=h.portal,v=q;r&&(v+="-{"+r+"}"),l.data[v]={key:v,userName:o,userId:q,fromSite:h.from,status:I[i],itemId:r,itemsId:s,portalId:u},e.className="ww-light ww-"+h.icon,m.className="ww-"+h.display,i===1?(b.addClass(m,"ww-online"),m.title=F.DEFAULT,p.appId&&p.appId==4&&(m.title=F.SNS),m.innerHTML="<span>\u65fa\u65fa\u5728\u7ebf</span>"):i===4||i===5?(b.addClass(m,"ww-mobile"),m.innerHTML="<span>\u624b\u673a\u5728\u7ebf</span>"):(b.addClass(m,"ww-offline"),m.innerHTML="<span>\u65fa\u65fa\u79bb\u7ebf</span>"),m.href=A+l._paramUserInfo(l.data[v],!0),c.on(m,"click",function(b){var c=a.unparam(d.get(n)),e=l.data[v],h=unescape((d.get("_nk_")||"").replace(/\\u/g,"%u"));(l.addonIsOK()||c&&c.e==1)&&b.preventDefault();if(!l.addonIsOK()){b.preventDefault();if(l._isOtherHost())alert("\u4f60\u6ca1\u6709\u5b89\u88c5\u963f\u91cc\u65fa\u65fa,\u8bf7\u4e0b\u8f7d\u963f\u91cc\u65fa\u65fa!"),window.open("http://www.taobao.com/wangwang");else if(h==""){t.indexOf("tmall")>-1?l._directToTBLogin(e.key):l._openTBLoginPopup(e.key);return}}!e.dispatched&&i<4?f.getScript(D+j(e.userId)+"&charset=utf-8",function(){var a=k(g.realcid);a&&a!==e.userId&&(e.userName=a.substring(8),e.userId=a),e.dispatched=!0,l._openChatDialog(e,m)},"utf-8"):l._openChatDialog(e,m)}),e.appendChild(m)},_setCookie:function(){d.set(n,a.param(cookieX),365,t,"/")},_directToTBLogin:function(b){var c=location,d=c.protocol+"//"+c.host+c.pathname,e=c.search,f=c.hash,g=c.href,h="wwlight",i=this,k="https://login."+w+"/member/login.jhtml?f=top";e=e?a.unparam(e.substring(1)):{},h in e&&delete e[h],b&&(e[h]=b),e=a.param(e),e=j(e),g=d+"?"+e+f,c.href=k+"?redirectUrl="+g},_openTBLoginPopup:function(d){function q(c){b.css(c,"left",parseInt(b.viewportWidth()/2)-parseInt(p.offsetWidth/2)+"px"),b.css(c,"top",parseInt(b.viewportHeight()/2)-parseInt(p.offsetHeight/2)+(a.UA.ie===6?b.scrollTop():0)+"px")}var e=location,f=e.protocol+"//"+e.host+e.pathname,g=e.search,h=e.hash,i=e.href,j="wwlight",k=this,l=location.hostname.indexOf("taobao.com")>-1,m,n="https://login."+w+"/member/login.jhtml?f=top";g=g?a.unparam(g.substring(1)):{},j in g&&delete g[j],d&&(g[j]=d,k.isSearch()?(m=g.q,delete g.q,g[j]=d):g[j]=d),g=a.param(g),!this.isSearch()||m&&(g="q="+m+"&"+g),i=f+"?"+g+h;var e=location;b.addStyleSheet(".tstart-login{width:410px;height:300px;bottom:100px;left:200px;opacity:1;position:fixed;_position:absolute;z-index:5000;background-color:#fff;padding:0;overflow:hidden;-moz-border-radius-bottomleft:5px;-moz-border-radius-bottomright:5px;-moz-border-radius-topleft:5px;-moz-border-radius-topright:5px;border:7px solid #BBB;}.tstart-login .hd{height:22px;line-height:22px;padding-left:8px;border-bottom:1px solid #D1D1D1;font-weight:bold;background-color:#fff;}.tstart-login .ft{background-color:#F5F5F5;}.tstart-login .ft .btn-close{color:#C9C9C9;font-family:Tahoma,sans;font-size:12px;font-weight:bold;position:absolute;right:8px;text-decoration:none;top:3px;}");var o='<div id="tstartLogin" class="tstart-login"><div class="hd"><h3></h3></div><div class="bd" style="padding: 0px; overflow: hidden;"><iframe width="410" height="270" frameborder="0" scrolling="no" id="frameContent" name="frameContent" ></iframe></div><div class="ft"><a class="btn-close" title="\u5173\u95ed\u6b64\u7a97\u53e3" href="javascript:void(0)">x</a></div></div>',p=a.get(".tstart-login");if(!p){p=a.DOM.create(o),document.body.appendChild(p),q(p),c.on(a.get(".btn-close",p),"click",function(){b.css(p,"display","none")}),6===a.UA.ie?c.on(window,"scroll resize",function(){q(p)}):c.on(window,"scroll resize",function(){b.css(p,"left",parseInt(b.viewportWidth()/2)-parseInt(p.offsetWidth/2)+"px")});if(!l)var r="http://www.daily.taobao.net/go/act/share/loginsuccess.php";else var r="http://www.taobao.com/go/act/share/loginsuccess.php";var s="https://login."+w+"/member/login.jhtml?style=mini&full_redirect=false&redirect_url="+r,t=p.getElementsByTagName("iframe")[0];t.src=s,c.on(t,"load",function(){x()&&(location.href=i)})}else b.css(p,"display","block"),q(p)},_isOtherHost:function(){var a=location.hostname,b=["tmall.net","tmall.com","taobao.com","daily.taobao.net"],c=b.length;for(i=0;i<c;i++)if(a.indexOf(b[i])>-1)return!1;return!0},isSearch:function(){var a=["search.taobao.com","sandbox.search.taobao.com","search8.taobao.com","search8.daily.taobao.net","s.taobao.com","list.mall.daily.taobao.net","list.mall.taobao.com","s8.taobao.com"],b,c=a.length,d=location;for(b=0;b<c;b++)if(d.host.indexOf(a[b]>-1))return!0},_paramUserInfo:function(a,b,c){var d=a.userId||a.siteid+a.touid,e="";return b&&(d=j(d)),y!=6?"uid="+d.split("cntaobao")[1]+"&tositeid="+a.fromSite+"&status="+a.status+"&suid="+a.portalId:(c&&c.parentNode&&(e=c.parentNode.getAttribute("data-items")||""),"&touid="+d+"&siteid="+(a.fromSite||a.siteid)+"&status="+a.status+"&portalId="+(a.portalId||"")+"&gid="+(a.itemId||"")+"&itemsId="+e)},_openChatDialog:function(b,c){var e=this,f=1,h=a.unparam(d.get("x"));if(e.addonIsOK()){if(y!=6)g.location="wangwang:SendIM?"+e._paramUserInfo(b,null,c);else try{(new ActiveXObject("AliIMX.WangWangX")).ExecCmd("Aliim:sendmsg?"+e._paramUserInfo(b,null,c))}catch(i){g.location="aliim:sendmsg?"+e._paramUserInfo(b,null,c)}f=0}else h&&h.e==1&&TDog.EventCenter&&(e._isOtherHost()||TDog.EventCenter.fire(TDog.EVENTS.CLICK_LIGHT_ICON,{userInfo:b}),f=2);K(E+"&uid="+m+"&tid="+b.userId+"&gid="+b.itemId+"&ver="+f+"&browse="+s+"&playform="+navigator.platform)},_checkWangWangInstalled:function(){var b=!1,c=a.unparam(d.get(n)),f=navigator.platform.indexOf("Mac")>-1?!0:!1;if(!f){c.c==1&&(b=!0,r=1);if(!b&&e.ie)b=this._checkWangWangVersion();else if(e.firefox||e.chrome){var g=navigator.mimeTypes["application/ww-plugin"];if(g){var i=h.createElement("embed");i.setAttribute("type","application/ww-plugin"),a.DOM.css(i,"visibility","hidden"),a.DOM.css(i,"width",0),a.DOM.css(i,"height",0),KISSY.ready(function(a){h.body.appendChild(i),numberify=function(a){var b=0;return parseFloat(a.replace(/\./g,function(){return b++===0?".":""}))},i.NPWWVersion&&numberify(i.NPWWVersion())>=1.003?b=!0:b=!1,i.tagName.toLowerCase()=="embed"&&i.parentNode.removeChild(i),c.c=0,d.set(n,a.param(c),365,t,"/")})}}}else if(e.firefox||e.chrome||e.opera||e.safari){var g=navigator.mimeTypes["application/ww-plugin"];if(g){var i=h.createElement("embed");i.setAttribute("type","application/ww-plugin"),a.DOM.css(i,"visibility","hidden"),a.DOM.css(i,"width",0),a.DOM.css(i,"height",0),h.body.appendChild(i),i.isMacWWInstalled()&&(b=!0),i.parentNode.removeChild(i),c.c=0,d.set(n,a.param(c),365,t,"/")}}return b&&(c.c=1,d.set(n,a.param(c),365,t,"/")),location.href.indexOf("topen")>-1&&(b=!1),b},_checkWangWangVersion:function(){var b,c=!0,f=a.unparam(d.get(n));try{b=new ActiveXObject("aliimx.wangwangx")}catch(g){try{b=new ActiveXObject("WangWangX.WangWangObj"),y=5}catch(g){e.ie&&(f.c=0,c=!1,r=0,d.set(n,a.param(f),365,t,"/"))}}finally{b=null}return c},_getParamsFromData:function(a){var c=b.attr(a,"data-encode")||!1,d=b.attr(a,"data-nick")||"";return c&&(d=k(d)),{nick:d,item:b.attr(a,"data-item")||(g.g_config||{}).itemId||"",items:b.attr(a,"data-items")||"",display:b.attr(a,"data-display")||"inline",icon:b.attr(a,"data-icon")||"large",from:b.attr(a,"data-from")||"cntaobao",portal:b.attr(a,"data-portal")||"",fromId:b.attr(a,"data-portal")||"",encode:j}}};window.Light=J,a.ready(function(){J.initStart(),J.init()})}();